<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Ejemplo de cliente Node.js</title>
	<script type="text/javascript" src="jquery.js"></script>
	<script src="socket.io.js"></script>
	<script>
		var servidorNode = 'http://127.0.0.1'; 
		var puerto = 8008; 
		var socket;
		var id_user;
		
		try {
			socket = io.connect(servidorNode+':'+puerto+'/');
			
			socket.on('Multicast', function (data) {
				alert(' El texto multicast de la sala ' + data.room +' es: ' + data.texto );
			});	

		}
		catch (err) {
			alert('No está disponible el servidor Node.js');
		}	

		function salaPrincipal() {
			var id = "0";
			id_user = id;
			socket.emit('ejemplo3', {room: id});
		}
		
		function ejemplo2() {
			var texto = document.getElementById('inputTextMulticast').value;
			var e = document.getElementById("dropdown");//multiples opciones
			var id = e.options[e.selectedIndex].text;//selecina multiple opcion
			socket.emit('ejemplo2', {text: texto,room: id});
		}
		
		function ejemplo3() {
			var id=id_user;
			socket.emit('salirRoom', {room: id});
			var e = document.getElementById("dropdown");
			id = e.options[e.selectedIndex].text;
			id_user = id;
			socket.emit('ejemplo3', {room: id});
		}	
		
		function salirRoom() {
			var e = document.getElementById("dropdown");
			var id = e.options[e.selectedIndex].text;
			socket.emit('salirRoom', {room: id});
			id = "0";
			socket.emit('ejemplo3', {room: id});
			var valor = "There";
			$("#dropdown option[value="+ valor +"]").attr("selected",true);
		}	
		
	</script>
</head>
<body onload="salaPrincipal()">
	<div id="main">
		<h2> EJEMPLO MULTICAST</h2>
		<div>
			<input id="inputTextMulticast" type="text" ></input>
			<input id="btn1" type="button" onclick="ejemplo2()" value="Multicast" ></input>
		</div>
		<div>
			 <label for="dropdown">Seleccione Una Sala</label>
			 <select id="dropdown" onChange="ejemplo3()"></select> <!--se detecta cambio, se carga la funcion ejemplo3 automatico -->
			 <input id="btn_salirRoom" type="button" onClick="salirRoom()" value="Salir Room" ></input>
			 <br><br> 
		</div>
	</div>
<script>
var ddl = document.getElementById("dropdown");
ddl.options.add(new Option("0","There"));
ddl.options.add(new Option("1","There1"));
ddl.options.add(new Option("2","There2"));
</script>
</body>